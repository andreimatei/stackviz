<div class="app">
  <mat-sidenav-container class="example-container" autosize>
    <mat-sidenav #functionDrawer mode="side" position="end"
                 class="func-details-drawer"
                 mode="side"
                 mwlResizable
                 [enableGhostResize]="true"
                 [ngStyle]="style"
                 [validateResize]="validateResize"
                 (resizeEnd)="onResizeEnd($event)"
    >
      <div
        class="resize-handle-left"
        mwlResizeHandle
        [resizeEdges]="{ left: true }"
      >
      </div>


      <div style="padding-left: 5px;">
        <div style="display: flex; flex-flow: row; justify-content: space-between;">
          <h2>Function details</h2>
          <button mat-icon-button mat-dialog-close (click)="closeSidebar()">
            <mat-icon>close</mat-icon>
          </button>
        </div>
        <b>
          {{selectedFrame?.name}}
        </b>
        <pre>{{selectedFrame?.file}}:{{selectedFrame?.line}}</pre>
      </div>

      <mat-expansion-panel expanded style="margin-left: 5px">
        <mat-expansion-panel-header>
          <mat-panel-title>
            Available variables
          </mat-panel-title>
          <mat-panel-description>
            The variables available in this frame.
          </mat-panel-description>
        </mat-expansion-panel-header>

        <mat-progress-bar mode="indeterminate" *ngIf="loadingAvailableVars"></mat-progress-bar>
        <type-info (checkedChange)="checkedChange($event)"/>
      </mat-expansion-panel>

      <mat-expansion-panel expanded style="margin-left: 5px">
        <mat-expansion-panel-header>
          <mat-panel-title>
            Captured variables
          </mat-panel-title>
          <mat-panel-description>
            The variables captured from all stack traces featuring this frame.
          </mat-panel-description>
        </mat-expansion-panel-header>

        <mat-accordion multi>
          <mat-expansion-panel expanded *ngFor="let frame of funcInfo">
            <mat-expansion-panel-header>
              <mat-panel-title>
                Frame info
              </mat-panel-title>
            </mat-expansion-panel-header>
            <ul>
              <li *ngFor="let v of frame">
                {{v.Expr}}: {{v.Value}}
              </li>
            </ul>
          </mat-expansion-panel>
        </mat-accordion>
      </mat-expansion-panel>
    </mat-sidenav>

    <mat-sidenav-content>
      <p>
        Collection <a routerLink="/collections"> {{ collectionName }} </a>
        <br>
        Snapshot ID: {{snapshotID}}
      </p>
      <mat-form-field>
        <mat-label>Snapshots</mat-label>
        <mat-select #snapshotsSelect
                    (selectionChange)="onSelectedSnapshotChange(snapshotsSelect.value)"
                    [value]="snapshotID"
        >
          <mat-option *ngFor="let snap of snapshots"
                      [value]="snap.id">{{ snap.processID }}</mat-option>
        </mat-select>
      </mat-form-field>

      <p>
        <mat-form-field class="example-form-field">
          <mat-label>Filter</mat-label>
          <input matInput type="text" [(ngModel)]="filterVal" (ngModelChange)="onFilterChange($event, false)" placeholder="filter by package or function name">
          <button *ngIf="filter$ | async" matSuffix mat-icon-button (click)="filterVal=''; onFilterChange('', true);">
            <mat-icon>close</mat-icon>
          </button>
        </mat-form-field>
      </p>

      <app-flamegraph (ctrlClick)="showDetails($event)"></app-flamegraph>
      <app-stacks [colID]="collectionID" [snapID]="snapshotID$ | async"> </app-stacks>

    </mat-sidenav-content>
  </mat-sidenav-container>
</div>
