<div class="app">
  <app-core>
    <!--
      Define the global key-value mapping, with it initial values.  This global state provides
      communication between components.
    -->
    <global-state>
      <value-map>
        <!-- The collection loader finds collections at this name under
             google3/third_party/traceviz/codelab/logviz/server/logs/. -->
        <value key="collection_name">
          <string>cockroachdb_example_snapshot.txt</string>
        </value>
        <value key="path_prefix">
          <string-list></string-list>
        </value>
        <value key="filter">
          <string></string>
        </value>
      </value-map>
    </global-state>

    <!--
      A handler for Data queries issued to a connected backend via HTTP.
      Multiple components may use this to subscribe to DataSeries streams;
      these will be automatically updated as new data becomes available.
    -->
    <data-query [debounceMs]="50">
      <!--
        The set of filters to attach to DataRequests.  Each specified global
        value is provided with each DataRequest under the provided query key.
        Note that backend data series providers may ignore some global filters.
      -->
      <value-map>
        <value key="collection_name"><global-ref key="collection_name"></global-ref></value>
        <value key="path_prefix"><global-ref key="path_prefix"></global-ref></value>
        <value key="filter"><global-ref key="filter"></global-ref></value>
      </value-map>
    </data-query>
  </app-core>

  <text-field label="Filter" placeholder="enter module or function name" updateOnEnter=false>
    <interactions>
      <action target="text_field" type="update">
        <set>
          <global-ref key="filter"></global-ref>
          <local-ref key="contents"></local-ref>
        </set>
      </action>
    </interactions>
  </text-field>

  <weighted-tree>
    <data-series>
      <query>
        <string>stacks.tree</string>
      </query>

      <interactions>
        <reaction target="data-series" type="fetch">
          <and>
            <not>
              <equals>
                <global-ref key="collection_name"></global-ref>
                <string></string>
              </equals>
            </not>
            <or>
              <changed><global-ref key="collection_name"></global-ref></changed>
              <changed><global-ref key="path_prefix"></global-ref></changed>
              <changed><global-ref key="filter"></global-ref></changed>
            </or>
          </and>
        </reaction>
      </interactions>
    </data-series>


    <interactions>
      <action target="node" type="click">
        <set>
          <global-ref key="path_prefix"></global-ref>
          <local-ref key="path"></local-ref>
        </set>
      </action>
      <reaction target="node" type="highlight">
        <includes>
          <local-ref key="name"></local-ref>
          <string>sync.runtime_notifyListWait</string>
        </includes>
      </reaction>
    </interactions>

  </weighted-tree>

</div>
